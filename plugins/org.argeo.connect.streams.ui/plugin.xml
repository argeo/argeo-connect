<?xml version="1.0" encoding="UTF-8"?>
<?eclipse version="3.4"?>
<plugin>
   <extension
         point="org.eclipse.ui.perspectives">
      <perspective
            class="org.argeo.connect.streams.ui.RssPerspective"
            icon="icons/rss.png"
            id="org.argeo.connect.streams.ui.rssPerspective"
            name="Streams">
      </perspective>
	</extension>
   	<extension
         point="org.eclipse.ui.views">
      <!-- <view
            class="org.argeo.eclipse.spring.SpringExtensionFactory"
            id="org.argeo.connect.streams.ui.feedView"
            name="Feed"
            restorable="true">
      </view> --> 
      <view
            class="org.argeo.eclipse.spring.SpringExtensionFactory"
            icon="icons/rss.png"
            id="org.argeo.connect.streams.ui.rssSearchView"
            name="Connect Streams"
            restorable="true">
      </view>
   </extension>
	<!-- EDITORS --> 
	<extension
		point="org.eclipse.ui.editors">
		<editor
			class="org.argeo.eclipse.spring.SpringExtensionFactory"
			default="false"
			icon="icons/rss.png"
			id="org.argeo.connect.streams.ui.channelEditor"
			name="New...">
		</editor>
		<editor
			class="org.argeo.eclipse.spring.SpringExtensionFactory"
			default="false"
			icon="icons/rss.png"
			id="org.argeo.connect.streams.ui.channelEditorNoCTab"
			name="New...">
		</editor>
		<editor
			class="org.argeo.eclipse.spring.SpringExtensionFactory"
			default="false"
			icon="icons/search.png"
			id="org.argeo.connect.streams.ui.rssSearchPostEditor"
			name="New...">
		</editor>
   <!--    <editor
            class="org.argeo.eclipse.spring.SpringExtensionFactory"
            default="false"
            id="org.argeo.connect.streams.ui.linkEditor"
            name="Link">
      </editor> --> 
	</extension>
   	<!-- COMMANDS -->	
	<extension
         point="org.eclipse.ui.commands">
		<command
			defaultHandler="org.argeo.eclipse.spring.SpringExtensionFactory"
        	id="org.argeo.connect.people.ui.deleteEntity"
            name="deleteEntity">
            <commandParameter
         		id="param.removeParent"
         		name="Remove Parent node or not">
  	 		</commandParameter>
            <commandParameter
         		id="param.toRemoveJcrId"
         		name="Jcr ID of the node to remove">
  	 		</commandParameter>
    	</command>
   	</extension>
    <extension point="org.eclipse.ui.menus">
		<menuContribution locationURI="toolbar:org.argeo.connect.streams.ui.rssSearchView">
				<!-- can also use org.argeo.connect.people.ui.doNothing -->
				<command
					commandId="org.argeo.security.ui.rap.userMenuCommand"
					icon="icons/main.gif"
					id="org.argeo.connect.streams.ui.userToolbar"
					style="pulldown">
				</command>
		</menuContribution>
		<menuContribution locationURI="menu:org.argeo.connect.streams.ui.userToolbar">
			<command
				commandId="org.argeo.security.ui.rap.openChangePasswordDialog"
				icon="icons/password.gif"
				label="Change password"/>
			<separator
				name="org.argeo.security.ui.rap.beforeFile"
				visible="true">
			</separator>
			<command
				commandId="org.eclipse.ui.file.closeAll"
				icon="icons/closeAll.gif"/>
			<command commandId="org.eclipse.ui.file.save"/>
			<command commandId="org.eclipse.ui.file.saveAll"/>
			<separator
				name="org.argeo.security.ui.rap.beforeExit"
				visible="true">
			</separator>
			<command commandId="org.eclipse.ui.views.showView"/>
			<!--FIXME Do not permit this: no cool bar in Streams UI : we cannot come back! -->
			<!--<command commandId="org.eclipse.ui.perspectives.showPerspective"/>-->
			<command
				commandId="org.eclipse.ui.file.exit"
				icon="icons/exit.png"/>
		</menuContribution>
		<!-- Workaround: enable opening of other perspective for admin use --> 		 
		 <menuContribution locationURI="menu:org.argeo.security.ui.rap.mainMenu?after=org.argeo.security.ui.rap.beforeExit">
			<command commandId="org.eclipse.ui.perspectives.showPerspective"/>
		</menuContribution>
		
		
	</extension>
    <!-- SPECIFIC MANAGEMENT OF THE CHECK OUT ITEM -->
	<extension
		point="org.eclipse.ui.handlers">
		<handler
			class="org.argeo.connect.people.ui.commands.CheckOutItem"
			commandId="org.argeo.connect.people.ui.checkOutItem">
			<activeWhen>
					<with
						variable="org.argeo.connect.people.ui.checkOutState">
						<equals value="notCheckedOut" />
					</with>
    			
			</activeWhen>
		</handler>
		<handler
			class="org.argeo.connect.people.ui.commands.CancelAndCheckInItem"
			commandId="org.argeo.connect.people.ui.cancelAndCheckInItem">
			<activeWhen>
					<with
						variable="org.argeo.connect.people.ui.checkOutState">
						<equals value="checkedOut" />
					</with>
			</activeWhen>
		</handler>
	</extension>

	<!-- Workbench listeners --> 
	<extension point="org.eclipse.ui.startup">
   		<startup class="org.argeo.connect.people.ui.listeners.PartStateChanged"/>
	</extension>

	<!-- Services -->
	<extension
      	point="org.eclipse.ui.services">
	   	<sourceProvider
	        provider="org.argeo.connect.people.ui.utils.CheckoutSourceProvider">
	     	<variable
	            name="org.argeo.connect.people.ui.checkOutState"
	            priorityLevel="workbench">
	      	</variable>
	   	</sourceProvider>
	</extension>
		<!-- Entry point for the RAP application --> 
	<extension
		point="org.eclipse.rap.ui.entrypoint">
		<!-- Entry point for rap 2.0 and eclipse 4.2 with rap tooling --> 
		<entrypoint
			id="org.argeo.connect.streams.rap.entrypoint"
			class="org.argeo.connect.streams.ui.rap.RssSecureEntryPoint"
			path="/streams"
			brandingId="org.argeo.connect.streams.rap.defaultBranding">
		</entrypoint>
		<!-- Workaround: add toolbar for admin use --> 
		<entrypoint
			id="org.argeo.connect.streams.rap.adminentrypoint"
			class="org.argeo.security.ui.rap.SecureEntryPoint"
			path="/streamsAdmin"
			brandingId="org.argeo.connect.streams.rap.defaultBranding">
		</entrypoint>
	</extension>
 
 	<!-- BRANDING --> 
	<extension
		point="org.eclipse.rap.ui.branding">
		<branding
			id="org.argeo.connect.streams.rap.defaultBranding"
			themeId="org.argeo.connect.streams.rap.defaultBaseTheme"
			title="Connect Streams"
			favicon="icons/rss.png">
		</branding>
	</extension>
	
	<!-- LOCAL THEMES --> 
	<extension
		point="org.eclipse.rap.ui.themes">
		<theme
			id="org.argeo.connect.streams.rap.defaultBaseTheme"
			name="RAP Business Theme"
			file="theme/defaultBase.css" />
		<themeContribution
			themeId="org.argeo.connect.streams.rap.defaultBaseTheme"
			file="theme/defaultExt.css" />
	</extension> 
	
</plugin>
